<!DOCTYPE html>
<html>
<head>
    <title>ðŸŽ‰ Jaime's Epic Birthday Party! ðŸŽ‰</title>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            font-family: Arial, sans-serif;
            background: #000;
        }
        
        #loading {
            position: fixed;
            width: 100%;
            height: 100%;
            background: linear-gradient(45deg, #ff006e, #8338ec, #3a86ff);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        
        #loading h1 {
            color: white;
            font-size: 48px;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }
        
        #controls {
            position: fixed;
            top: 20px;
            left: 20px;
            z-index: 100;
            background: rgba(0,0,0,0.8);
            padding: 20px;
            border-radius: 10px;
            color: white;
            max-width: 300px;
        }
        
        button {
            background: linear-gradient(45deg, #ff006e, #8338ec);
            color: white;
            border: none;
            padding: 10px 20px;
            margin: 5px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
        }
        
        button:hover {
            transform: scale(1.05);
        }
        
        #songInfo {
            margin: 10px 0;
            padding: 10px;
            background: rgba(255,255,255,0.1);
            border-radius: 5px;
        }
    </style>
</head>
<body>
    <div id="loading">
        <h1>ðŸŽˆ Loading Birthday Magic... ðŸŽˆ</h1>
    </div>
    
    <div id="controls" style="display: none;">
        <h2>ðŸŽ‰ Jaime's Birthday Controls ðŸŽ‰</h2>
        
        <div id="songInfo">
            <strong>Now Playing:</strong>
            <div id="currentSong">Click a song to play!</div>
        </div>
        
        <div>
            <h3>ðŸŽµ Music</h3>
            <button onclick="playSong(0)">Play Song 1</button>
            <button onclick="playSong(1)">Play Song 2</button>
            <button onclick="playSong(2)">Play Song 3</button>
            <button onclick="toggleMusic()">Pause/Resume</button>
        </div>
        
        <div>
            <h3>âœ¨ Effects</h3>
            <button onclick="spawnConfetti()">ðŸŽŠ Confetti!</button>
            <button onclick="launchFirework()">ðŸŽ† Firework!</button>
            <button onclick="spawnBalloons()">ðŸŽˆ Balloons!</button>
            <button onclick="toggleRotation()">ðŸ”„ Auto-Rotate</button>
        </div>
        
        <div style="margin-top: 15px; font-size: 12px; opacity: 0.8;">
            <p>ðŸŽ® Keyboard Controls:</p>
            <p>SPACE = Confetti | F = Firework | B = Balloons</p>
            <p>1-3 = Switch Songs | R = Toggle Rotation</p>
        </div>
    </div>
    
    <audio id="audio" preload="auto"></audio>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script>
        // Fallback for when Three.js fails to load
        if (typeof THREE === 'undefined') {
            console.warn('Three.js failed to load from CDN. Creating mock objects to prevent freezing.');
            window.THREE = {
                Scene: function() { 
                    return { 
                        add: function(){}, 
                        remove: function(){}, 
                        fog: null 
                    }; 
                },
                PerspectiveCamera: function() { 
                    return { 
                        position: { set: function(){}, x: 0, y: 0, z: 0 }, 
                        lookAt: function(){},
                        aspect: 1,
                        updateProjectionMatrix: function(){}
                    }; 
                },
                WebGLRenderer: function() { 
                    return { 
                        domElement: document.createElement('div'), 
                        setSize: function(){}, 
                        setPixelRatio: function(){}, 
                        render: function(){} 
                    }; 
                },
                FogExp2: function() { return {}; },
                AmbientLight: function() { return {}; },
                PointLight: function() { 
                    return { 
                        position: { 
                            set: function(x, y, z) { this.x = x; this.y = y; this.z = z; return this; },
                            copy: function(v) { this.x = v.x; this.y = v.y; this.z = v.z; return this; },
                            add: function(v) { this.x += v.x; this.y += v.y; this.z += v.z; return this; },
                            x: 0, y: 0, z: 0
                        }, 
                        userData: {},
                        add: function(){}
                    }; 
                },
                FontLoader: function() { return { load: function(){} }; },
                TextGeometry: function() { return { center: function(){} }; },
                MeshPhongMaterial: function() { return {}; },
                Mesh: function() { 
                    return { 
                        position: { 
                            set: function(x, y, z) { this.x = x; this.y = y; this.z = z; return this; },
                            copy: function(v) { this.x = v.x; this.y = v.y; this.z = v.z; return this; },
                            add: function(v) { this.x += v.x; this.y += v.y; this.z += v.z; return this; },
                            x: 0, y: 0, z: 0
                        }, 
                        rotation: { x: 0, y: 0, z: 0 }, 
                        userData: {} 
                    }; 
                },
                BufferGeometry: function() { return { setAttribute: function(){} }; },
                Float32BufferAttribute: function() { return {}; },
                PointsMaterial: function() { return {}; },
                Points: function() { return { rotation: { y: 0 } }; },
                SphereGeometry: function() { return {}; },
                BoxGeometry: function() { return {}; },
                PlaneGeometry: function() { return {}; },
                MeshBasicMaterial: function() { return {}; },
                DoubleSide: 0,
                Vector3: function(x, y, z) { 
                    return { 
                        x: x || 0, y: y || 0, z: z || 0,
                        set: function(x, y, z) { this.x = x; this.y = y; this.z = z; return this; }, 
                        copy: function(v) { this.x = v.x; this.y = v.y; this.z = v.z; return this; }, 
                        add: function(v) { this.x += v.x; this.y += v.y; this.z += v.z; return this; },
                        multiplyScalar: function(s) { this.x *= s; this.y *= s; this.z *= s; return this; },
                        clone: function(){ return new THREE.Vector3(this.x, this.y, this.z); }
                    }; 
                },
                Color: function() { return { setHSL: function(){}, r: 1, g: 1, b: 1 }; }
            };
            
            // Show error message to user
            setTimeout(() => {
                document.getElementById('loading').innerHTML = '<h1>ðŸŽ‰ Birthday Party (Fallback Mode) ðŸŽ‰</h1><p style="color: white; text-align: center;">3D effects unavailable, but the party controls still work!<br/>Try the buttons below!</p>';
                document.getElementById('loading').style.display = 'none';
                document.getElementById('controls').style.display = 'block';
            }, 2000);
        }
    </script>
    <script>
        // Scene setup
        let scene, camera, renderer;
        let particles = [];
        let balloons = [];
        let confettiParticles = [];
        let fireworks = [];
        let autoRotate = true;
        let time = 0;
        
        // Audio setup
        const audio = document.getElementById('audio');
        let currentSongIndex = 0;
        const songs = [
            { file: 'song1.mp3', name: 'ðŸŽµ Happy Birthday Dude!' },
            { file: 'song2.mp3', name: 'ðŸŽµ Happy B-Day Jaime!' },
            { file: 'song3.mp3', name: 'ðŸŽµ Yo Jaime, It\'s Your Day!' }
        ];
        
        function init() {
            try {
                // Check if Three.js is available
                if (typeof THREE === 'undefined') {
                    console.error('Three.js is not available. Cannot initialize 3D scene.');
                    return;
                }
                
                // Create scene
                scene = new THREE.Scene();
                scene.fog = new THREE.FogExp2(0x000033, 0.008);
            
            // Create camera
            camera = new THREE.PerspectiveCamera(
                75,
                window.innerWidth / window.innerHeight,
                0.1,
                1000
            );
            camera.position.set(0, 10, 30);
            camera.lookAt(0, 0, 0);
            
            // Create renderer
            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.setPixelRatio(window.devicePixelRatio);
            document.body.appendChild(renderer.domElement);
            
            // Lights
            const ambientLight = new THREE.AmbientLight(0x404040);
            scene.add(ambientLight);
            
            const pointLight1 = new THREE.PointLight(0xff00ff, 2, 100);
            pointLight1.position.set(20, 20, 20);
            scene.add(pointLight1);
            
            const pointLight2 = new THREE.PointLight(0x00ffff, 2, 100);
            pointLight2.position.set(-20, 20, -20);
            scene.add(pointLight2);
            
            const pointLight3 = new THREE.PointLight(0xffff00, 2, 100);
            pointLight3.position.set(0, 30, 0);
            scene.add(pointLight3);
            
            // Create main text
            const loader = new THREE.FontLoader();
            loader.load('https://threejs.org/examples/fonts/helvetiker_bold.typeface.json', function(font) {
                // Happy Birthday text
                const textGeometry1 = new THREE.TextGeometry('HAPPY BIRTHDAY', {
                    font: font,
                    size: 3,
                    height: 0.5,
                    curveSegments: 12,
                    bevelEnabled: true,
                    bevelThickness: 0.1,
                    bevelSize: 0.05,
                    bevelSegments: 5
                });
                
                const textMaterial1 = new THREE.MeshPhongMaterial({
                    color: 0xff00ff,
                    emissive: 0xff00ff,
                    emissiveIntensity: 0.3,
                    shininess: 100
                });
                
                const textMesh1 = new THREE.Mesh(textGeometry1, textMaterial1);
                textGeometry1.center();
                textMesh1.position.y = 10;
                scene.add(textMesh1);
                
                // JAIME text
                const textGeometry2 = new THREE.TextGeometry('JAIME', {
                    font: font,
                    size: 5,
                    height: 1,
                    curveSegments: 12,
                    bevelEnabled: true,
                    bevelThickness: 0.2,
                    bevelSize: 0.1,
                    bevelSegments: 5
                });
                
                const textMaterial2 = new THREE.MeshPhongMaterial({
                    color: 0xffd700,
                    emissive: 0xffaa00,
                    emissiveIntensity: 0.4,
                    shininess: 100
                });
                
                const textMesh2 = new THREE.Mesh(textGeometry2, textMaterial2);
                textGeometry2.center();
                textMesh2.position.y = 3;
                scene.add(textMesh2);
            });
            
            // Create particle field
            createParticleField();
            
            // Create initial balloons
            createBalloons(20);
            
            // Create floor
            const floorGeometry = new THREE.PlaneGeometry(100, 100);
            const floorMaterial = new THREE.MeshBasicMaterial({
                color: 0x111144,
                side: THREE.DoubleSide,
                transparent: true,
                opacity: 0.5
            });
            const floor = new THREE.Mesh(floorGeometry, floorMaterial);
            floor.rotation.x = -Math.PI / 2;
            floor.position.y = -10;
            scene.add(floor);
            
            // Hide loading, show controls
            document.getElementById('loading').style.display = 'none';
            document.getElementById('controls').style.display = 'block';
            
            // Start animation
            animate();
        } catch (error) {
            console.error('Error initializing scene:', error);
            // Show error message to user
            document.getElementById('loading').innerHTML = '<h1>ðŸš¨ Initialization Error ðŸš¨</h1><p style="color: white; text-align: center;">There was an error starting the 3D scene.<br/>Please refresh the page to try again.</p>';
        }
    }
        
        function createParticleField() {
            const particleCount = 1000;
            const geometry = new THREE.BufferGeometry();
            const positions = [];
            const colors = [];
            
            for (let i = 0; i < particleCount; i++) {
                positions.push(
                    (Math.random() - 0.5) * 100,
                    (Math.random() - 0.5) * 100,
                    (Math.random() - 0.5) * 100
                );
                
                colors.push(Math.random(), Math.random(), Math.random());
            }
            
            geometry.setAttribute('position', new THREE.Float32BufferAttribute(positions, 3));
            geometry.setAttribute('color', new THREE.Float32BufferAttribute(colors, 3));
            
            const material = new THREE.PointsMaterial({
                size: 0.5,
                vertexColors: true,
                transparent: true,
                opacity: 0.8
            });
            
            const points = new THREE.Points(geometry, material);
            scene.add(points);
            particles.push(points);
        }
        
        function createBalloons(count) {
            for (let i = 0; i < count; i++) {
                const geometry = new THREE.SphereGeometry(2, 32, 32);
                const material = new THREE.MeshPhongMaterial({
                    color: new THREE.Color().setHSL(Math.random(), 1, 0.5),
                    shininess: 100,
                    transparent: true,
                    opacity: 0.8
                });
                
                const balloon = new THREE.Mesh(geometry, material);
                balloon.position.set(
                    (Math.random() - 0.5) * 40,
                    Math.random() * 20 - 5,
                    (Math.random() - 0.5) * 40
                );
                
                balloon.userData = {
                    floatSpeed: Math.random() * 0.02 + 0.01,
                    floatOffset: Math.random() * Math.PI * 2
                };
                
                scene.add(balloon);
                balloons.push(balloon);
            }
        }
        
        function spawnConfetti() {
            const count = 50;
            for (let i = 0; i < count; i++) {
                const geometry = new THREE.BoxGeometry(0.3, 0.3, 0.1);
                const material = new THREE.MeshPhongMaterial({
                    color: new THREE.Color().setHSL(Math.random(), 1, 0.5)
                });
                
                const confetti = new THREE.Mesh(geometry, material);
                confetti.position.set(
                    (Math.random() - 0.5) * 10,
                    20,
                    (Math.random() - 0.5) * 10
                );
                
                confetti.userData = {
                    velocity: new THREE.Vector3(
                        (Math.random() - 0.5) * 0.5,
                        Math.random() * 0.2,
                        (Math.random() - 0.5) * 0.5
                    ),
                    rotationSpeed: new THREE.Vector3(
                        Math.random() * 0.2,
                        Math.random() * 0.2,
                        Math.random() * 0.2
                    ),
                    life: 300
                };
                
                scene.add(confetti);
                confettiParticles.push(confetti);
            }
        }
        
        function launchFirework() {
            try {
                // Check if Three.js and scene are properly initialized
                if (typeof THREE === 'undefined' || !scene || !scene.add) {
                    console.warn('Cannot launch firework: Three.js not properly loaded');
                    return;
                }
                
                const colors = [0xff0000, 0x00ff00, 0x0000ff, 0xffff00, 0xff00ff];
                const color = colors[Math.floor(Math.random() * colors.length)];
                
                const light = new THREE.PointLight(color, 5, 50);
                light.position.set(
                    (Math.random() - 0.5) * 30,
                    0,
                    (Math.random() - 0.5) * 30
                );
                
                light.userData = {
                    velocity: new THREE.Vector3(0, 0.5, 0),
                    life: 100,
                    color: color
                };
                
                scene.add(light);
                fireworks.push(light);
            } catch (error) {
                console.error('Error launching firework:', error);
            }
        }
        
        function spawnBalloons() {
            createBalloons(10);
        }
        
        function toggleRotation() {
            try {
                autoRotate = !autoRotate;
                console.log('Auto-rotation toggled:', autoRotate ? 'ON' : 'OFF');
                
                // Update button text to give user feedback
                const button = event.target;
                if (button) {
                    button.textContent = autoRotate ? 'â¸ï¸ Stop Rotate' : 'â–¶ï¸ Auto-Rotate';
                }
            } catch (error) {
                console.error('Error toggling rotation:', error);
            }
        }
        
        function playSong(index) {
            currentSongIndex = index;
            audio.src = songs[index].file;
            audio.play();
            document.getElementById('currentSong').textContent = songs[index].name;
        }
        
        function toggleMusic() {
            if (audio.paused) {
                audio.play();
            } else {
                audio.pause();
            }
        }
        
        function animate() {
            requestAnimationFrame(animate);
            
            try {
                time += 0.01;
                
                // Rotate camera - only if camera and Three.js are available
                if (autoRotate && camera && camera.position && camera.lookAt) {
                    camera.position.x = Math.cos(time * 0.5) * 30;
                    camera.position.z = Math.sin(time * 0.5) * 30;
                    camera.lookAt(0, 0, 0);
                }
                
                // Animate particles - only if particles array exists
                if (particles && Array.isArray(particles)) {
                    particles.forEach(particle => {
                        if (particle && particle.rotation) {
                            particle.rotation.y += 0.001;
                        }
                    });
                }
                
                // Animate balloons - only if balloons array exists
                if (balloons && Array.isArray(balloons)) {
                    balloons.forEach(balloon => {
                        if (balloon && balloon.position && balloon.userData) {
                            balloon.position.y += Math.sin(time + balloon.userData.floatOffset) * balloon.userData.floatSpeed;
                            if (balloon.rotation) {
                                balloon.rotation.y += 0.01;
                            }
                        }
                    });
                }
                
                // Update confetti - only if confettiParticles array exists
                if (confettiParticles && Array.isArray(confettiParticles)) {
                    confettiParticles = confettiParticles.filter(confetti => {
                        if (!confetti || !confetti.position || !confetti.userData) {
                            return false;
                        }
                        
                        try {
                            confetti.position.add(confetti.userData.velocity);
                            confetti.userData.velocity.y -= 0.01; // gravity
                            
                            if (confetti.rotation && confetti.userData.rotationSpeed) {
                                confetti.rotation.x += confetti.userData.rotationSpeed.x;
                                confetti.rotation.y += confetti.userData.rotationSpeed.y;
                                confetti.rotation.z += confetti.userData.rotationSpeed.z;
                            }
                            
                            confetti.userData.life--;
                            
                            if (confetti.userData.life <= 0 || confetti.position.y < -10) {
                                if (scene && scene.remove) {
                                    scene.remove(confetti);
                                }
                                return false;
                            }
                            return true;
                        } catch (error) {
                            console.warn('Error updating confetti particle:', error);
                            return false;
                        }
                    });
                }
                
                // Update fireworks - only if fireworks array exists
                if (fireworks && Array.isArray(fireworks)) {
                    fireworks = fireworks.filter(firework => {
                        if (!firework || !firework.position || !firework.userData) {
                            return false;
                        }
                        
                        try {
                            firework.position.add(firework.userData.velocity);
                            firework.userData.life--;
                            
                            if (firework.userData.life === 50) {
                                // Explode! - but only if Three.js is available
                                if (typeof THREE !== 'undefined' && scene && scene.add) {
                                    for (let i = 0; i < 20; i++) {
                                        const particle = new THREE.Mesh(
                                            new THREE.SphereGeometry(0.2),
                                            new THREE.MeshBasicMaterial({ color: firework.userData.color })
                                        );
                                        particle.position.copy(firework.position);
                                        particle.userData = {
                                            velocity: new THREE.Vector3(
                                                (Math.random() - 0.5) * 0.5,
                                                (Math.random() - 0.5) * 0.5,
                                                (Math.random() - 0.5) * 0.5
                                            ),
                                            life: 50
                                        };
                                        scene.add(particle);
                                        confettiParticles.push(particle);
                                    }
                                }
                            }
                            
                            if (firework.userData.life <= 0) {
                                if (scene && scene.remove) {
                                    scene.remove(firework);
                                }
                                return false;
                            }
                            return true;
                        } catch (error) {
                            console.warn('Error updating firework:', error);
                            return false;
                        }
                    });
                }
                
                // Render only if renderer and scene are available
                if (renderer && renderer.render && scene && camera) {
                    renderer.render(scene, camera);
                }
            } catch (error) {
                console.error('Error in animation loop:', error);
            }
        }
        
        // Keyboard controls
        document.addEventListener('keydown', (e) => {
            switch(e.key.toLowerCase()) {
                case ' ':
                    spawnConfetti();
                    break;
                case 'f':
                    launchFirework();
                    break;
                case 'b':
                    spawnBalloons();
                    break;
                case 'r':
                    toggleRotation();
                    break;
                case '1':
                    playSong(0);
                    break;
                case '2':
                    playSong(1);
                    break;
                case '3':
                    playSong(2);
                    break;
            }
        });
        
        // Window resize
        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });
        
        // Auto play next song
        audio.addEventListener('ended', () => {
            currentSongIndex = (currentSongIndex + 1) % songs.length;
            playSong(currentSongIndex);
        });
        
        // Initialize
        init();
    </script>
</body>
</html>
